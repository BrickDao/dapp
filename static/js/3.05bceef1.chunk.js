(this["webpackJsonpmolochv3-ui"]=this["webpackJsonpmolochv3-ui"]||[]).push([[3],{837:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return F}));var s=a(0),r=a(1),n=a(340),c=a(45),o=a(57),i=a(2),d=a.n(i),b=a(3),l=a(8),p=a(7),u=a(20),j=a(9),O=a(47),h=a(60),f=a(23),m=a(73),x=a(5),g=a(106),I=a(43),N=a(66),y=a(15),v=a(81);function P(e){var t=e.proposal,a=t.snapshotDraft,n=t.refetchProposalOrDraft,c=Object(r.useState)(),i=Object(p.a)(c,2),P=i[0],w=i[1],D=Object(u.c)((function(e){return e.contracts})),F=Object(u.c)((function(e){var t;return null===(t=e.contracts.DaoRegistryContract)||void 0===t?void 0:t.contractAddress})),A=Object(f.f)(),S=A.account,L=A.web3Instance,E=Object(f.a)(),G=E.txEtherscanURL,_=E.txIsPromptOpen,k=E.txSend,R=E.txStatus,W=Object(m.d)(),C=W.isDisabled,M=W.openWhyDisabledModal,T=W.WhyDisabledModal,V=Object(o.e)(),U=V.proposalSignAndSendStatus,J=V.signAndSendProposal,q=Object(f.b)(),z=R===x.e.AWAITING_CONFIRM||R===x.e.PENDING||U===x.e.AWAITING_CONFIRM||U===x.e.PENDING,B=R===x.e.FULFILLED&&U===x.e.FULFILLED,H=z||B||_;function K(){return(K=Object(l.a)(d.a.mark((function e(){var t,s,r,c,o,i,l,p,u,h,f,m,x;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F){e.next=3;break}throw new Error("No DAO Registry address was found.");case 3:if(a){e.next=5;break}throw new Error("No Snapshot draft was found.");case 5:return t=Object(O.d)(a.actionId,D),s=a.msg,r=s.payload,c=r.name,o=r.body,i=r.metadata,l=s.timestamp,e.next=9,J({partialProposalData:{name:c,body:o,metadata:i,timestamp:l},adapterAddress:t.contractAddress,type:j.SnapshotType.proposal});case 9:return p=e.sent,u=p.data,h=p.signature,f=Object(j.prepareVoteProposalData)({payload:{name:u.payload.name,body:u.payload.body,choices:u.payload.choices,snapshot:u.payload.snapshot.toString(),start:u.payload.start,end:u.payload.end},sig:h,space:u.space,timestamp:parseInt(u.timestamp)},L),m=[F,a.idInDAO,f],x=Object(b.a)({from:S||""},q?{gasPrice:q.fast}:null),e.next=17,k("sponsorProposal",t.instance.methods,m,x);case 17:n(),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),w(e.t0);case 23:case"end":return e.stop()}}),e,null,[[0,20]])})))).apply(this,arguments)}return Object(s.jsxs)(s.Fragment,{children:[Object(s.jsxs)("div",{children:[Object(s.jsx)("button",{className:"proposaldetails__button",disabled:C||H,onClick:C||H?function(){}:function(){return K.apply(this,arguments)},children:z?Object(s.jsx)(v.a,{}):B?"Done":"Sponsor"}),Object(s.jsx)(I.a,{error:P,renderText:"Something went wrong"}),H&&Object(s.jsx)("div",{className:"form__submit-status-container",children:function(){if(R===x.e.AWAITING_CONFIRM||U===x.e.AWAITING_CONFIRM)return"Awaiting your confirmation\u2026";switch(R){case x.e.PENDING:return Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)(g.a,{intervalMs:2e3,messages:h.b,useFirstItemStart:!0,render:function(e){return Object(s.jsx)(y.a,{children:e},e)}}),Object(s.jsx)(N.a,{url:G,isPending:!0})]});case x.e.FULFILLED:return Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)("div",{children:"Proposal submitted!"}),Object(s.jsx)(N.a,{url:G})]});default:return null}}()}),C&&Object(s.jsx)("button",{className:"button--help",onClick:M,children:"Why is sponsoring disabled?"})]}),Object(s.jsx)(T,{title:"Why is sponsoring disabled?"})]})}var w=a(147);function D(e){var t=e.disabled,a=e.proposal.snapshotProposal,n=Object(r.useState)(),c=Object(p.a)(n,2),o=c[0],i=c[1],j=Object(u.c)((function(e){return e.contracts})),P=Object(u.c)((function(e){var t;return null===(t=e.contracts.DaoRegistryContract)||void 0===t?void 0:t.contractAddress})),D=Object(f.f)().account,F=Object(f.a)(),A=F.txEtherscanURL,S=F.txIsPromptOpen,L=F.txSend,E=F.txStatus,G=Object(m.d)(),_=G.isDisabled,k=G.openWhyDisabledModal,R=G.WhyDisabledModal,W=Object(f.b)(),C=E===x.e.AWAITING_CONFIRM||E===x.e.PENDING,M=E===x.e.FULFILLED,T=C||M||S,V=_||T||t;function U(){return(U=Object(l.a)(d.a.mark((function e(){var t,s,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,P){e.next=3;break}throw new Error("No DAO Registry address was found.");case 3:if(a){e.next=5;break}throw new Error("No Snapshot proposal was found.");case 5:return t=Object(O.d)(a.actionId,j),s=[P,a.idInDAO],r=Object(b.a)({from:D||""},W?{gasPrice:W.fast}:null),e.next=10,L("processProposal",t.instance.methods,s,r);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),i(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}return Object(s.jsxs)(s.Fragment,{children:[Object(s.jsxs)("div",{children:[Object(s.jsx)("button",{className:"proposaldetails__button",disabled:V,onClick:V?function(){}:function(){return U.apply(this,arguments)},children:C?Object(s.jsx)(v.a,{}):M?"Done":"Process"}),Object(s.jsx)(I.a,{error:o,renderText:"Something went wrong"}),T&&Object(s.jsx)("div",{className:"form__submit-status-container",children:function(){switch(E){case x.e.AWAITING_CONFIRM:return Object(s.jsxs)(s.Fragment,{children:["Awaiting your confirmation",Object(s.jsx)(w.a,{})]});case x.e.PENDING:return Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)(g.a,{intervalMs:2e3,messages:h.b,useFirstItemStart:!0,render:function(e){return Object(s.jsx)(y.a,{children:e},e)}}),Object(s.jsx)(N.a,{url:A,isPending:!0})]});case x.e.FULFILLED:return Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)("div",{children:"Proposal submitted!"}),Object(s.jsx)(N.a,{url:A})]});default:return null}}()}),_&&Object(s.jsx)("button",{className:"button--help",onClick:k,children:"Why is processing disabled?"})]}),Object(s.jsx)(R,{title:"Why is processing disabled?"})]})}function F(e){var t=e.adapterName,a=e.proposal,r=Object(o.c)(a),i=r.daoProposalVotes,d=r.status,b=i&&d===c.b.OffchainVotingGracePeriod?1e3*Number(i.gracePeriodStartingTime):0;return Object(s.jsxs)(s.Fragment,{children:[(d===c.b.OffchainVoting||d===c.b.OffchainVotingSubmitResult||d===c.b.OffchainVotingGracePeriod||d===c.b.Process||d===c.b.Completed)&&Object(s.jsx)(n.c,{countdownGracePeriodStartMs:b,proposal:a}),Object(s.jsxs)("div",{className:"proposaldetails__button-container",children:[d===c.b.Sponsor&&Object(s.jsx)(P,{proposal:a}),d===c.b.OffchainVoting&&Object(s.jsx)(n.b,{adapterName:t,proposal:a}),d===c.b.OffchainVotingSubmitResult&&Object(s.jsx)(n.a,{adapterName:t,proposal:a}),(d===c.b.OffchainVotingGracePeriod||d===c.b.Process)&&Object(s.jsx)(D,{disabled:d===c.b.OffchainVotingGracePeriod,proposal:a})]})]})}}}]);
//# sourceMappingURL=3.05bceef1.chunk.js.map