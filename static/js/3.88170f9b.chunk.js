(this["webpackJsonpmolochv3-ui"]=this["webpackJsonpmolochv3-ui"]||[]).push([[3],{971:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return B}));var a=n(0),s=n(1),r=n(3),c=n(4),o=n.n(c),i=n(14),d=n(10),l=n(23),u=n(24),b=n(9),j=n(49),p=n(13),h=n(92),O=n(115),f=n(25),x=n(136),m=n(53),v=n(93),g=n(21),N=n(69);function w(e){var t=e.adapterName,n=e.proposal.snapshotProposal,c=Object(s.useState)(b.e.STANDBY),w=Object(d.a)(c,2),I=w[0],y=w[1],D=Object(s.useState)(),S=Object(d.a)(D,2),C=S[0],P=S[1],A=Object(l.c)((function(e){var t;return null===(t=e.contracts.BankExtensionContract)||void 0===t?void 0:t.instance.methods})),F=Object(l.c)((function(e){var t;return null===(t=e.contracts.VotingContract)||void 0===t?void 0:t.instance.methods})),E=Object(l.c)((function(e){var t;return null===(t=e.contracts.DaoRegistryContract)||void 0===t?void 0:t.contractAddress})),k=Object(l.c)((function(e){return e.contracts})),L=Object(f.f)(),M=L.account,R=L.provider,_=Object(f.a)(),V=_.txEtherscanURL,G=_.txIsPromptOpen,W=_.txSend,T=_.txStatus,U=Object(O.e)(),Y=U.isDisabled,B=U.openWhyDisabledModal,H=U.WhyDisabledModal,J=Object(f.b)(),Z=I===b.e.AWAITING_CONFIRM||I===b.e.PENDING||T===b.e.AWAITING_CONFIRM||T===b.e.PENDING,z=T===b.e.FULFILLED&&I===b.e.FULFILLED,K=Z||z||G;function X(){return(X=Object(i.a)(o.a.mark((function e(){var a,s,c,d,l,O,f,x,m,v,g,N,w,I,D;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,E){e.next=3;break}throw new Error("No DAO Registry address was found.");case 3:if(n){e.next=5;break}throw new Error("No Snapshot proposal was found.");case 5:if(n.votes){e.next=7;break}throw new Error("No Snapshot proposal votes were found.");case 7:return y(b.e.AWAITING_CONFIRM),a=n.idInDAO,s=Object(j.d)(t,k),c=n.votes.map(function(){var e=Object(i.a)(o.a.mark((function e(t){var s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=Object.values(t)[0],e.t0=u.createVote,e.t1=a,e.t2=s.address,e.t3=s.msg.payload.choice===u.VoteChoicesIndex.Yes,e.t4=Number(s.msg.timestamp),e.t5=s.sig,e.next=9,A.getPriorAmount(s.address,p.w,n.msg.payload.snapshot).call();case 9:return e.t6=e.sent,e.t7={proposalHash:e.t1,account:e.t2,voteYes:e.t3,timestamp:e.t4,sig:e.t5,weight:e.t6},e.abrupt("return",(0,e.t0)(e.t7));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.t0=u.prepareVoteResult,e.t1=s,e.t2=p.g,e.t3=E,e.next=17,Promise.all(c);case 17:return e.t4=e.sent,e.t5={actionId:e.t1,chainId:e.t2,daoAddress:e.t3,votes:e.t4},e.next=21,(0,e.t0)(e.t5);case 21:return d=e.sent,l=d.voteResultTree,O=d.votes,f=l.getHexRoot(),x=Object(u.toStepNode)({actionId:s,chainId:p.g,merkleTree:l,step:O[O.length-1],verifyingContract:E}),m=Object(u.getVoteResultRootDomainDefinition)(E,s,p.g),v=m.domain,g=m.types,N=JSON.stringify({domain:v,message:{root:f},primaryType:h.a,types:g}),e.next=30,Object(u.signMessage)(R,M,N);case 30:return w=e.sent,y(b.e.FULFILLED),I=[E,a,f,Object(r.a)(Object(r.a)({},x),{},{rootSig:w})],D=Object(r.a)({from:M||""},J?{gasPrice:J.fast}:null),e.next=36,W("submitVoteResult",F,I,D);case 36:e.next=42;break;case 38:e.prev=38,e.t6=e.catch(0),P(e.t6),y(b.e.REJECTED);case 42:case"end":return e.stop()}}),e,null,[[0,38]])})))).apply(this,arguments)}return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{children:[Object(a.jsx)("button",{className:"proposaldetails__button",disabled:Y||K,onClick:Y||K?function(){}:function(){return X.apply(this,arguments)},children:Z?Object(a.jsx)(N.a,{}):z?"Done":"Submit Vote Result"}),Object(a.jsx)(m.a,{error:C,renderText:"Something went wrong"}),K&&Object(a.jsx)("div",{className:"form__submit-status-container",children:function(){if(T===b.e.AWAITING_CONFIRM||I===b.e.AWAITING_CONFIRM)return"Awaiting your confirmation\u2026";switch(T){case b.e.PENDING:return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(x.a,{intervalMs:2e3,messages:h.b,useFirstItemStart:!0,render:function(e){return Object(a.jsx)(g.a,{children:e},e)}}),Object(a.jsx)(v.a,{url:V,isPending:!0})]});case b.e.FULFILLED:return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)("div",{children:"Result submitted!"}),Object(a.jsx)(v.a,{url:V})]});default:return null}}()}),Y&&Object(a.jsx)("button",{className:"button--help",onClick:B,children:"Why is submitting disabled?"})]}),Object(a.jsx)(H,{title:"Why is this disabled?"})]})}var I=n(15);var y=n(78);function D(e){var t,n,c,j=e.adapterName,p=e.proposal,h=Object(s.useState)(),x=Object(d.a)(h,2),v=x[0],g=x[1],N=Object(s.useState)(),w=Object(d.a)(N,2),D=w[0],S=w[1],C=Object(s.useRef)({addressIsDelegatedMessage:"",alreadyVotedMessage:""}),P=Object(l.c)((function(e){var t;return null===(t=e.connectedMember)||void 0===t?void 0:t.delegateKey})),A=Object(f.f)().account,F=Object(y.e)(),E=F.signAndSendVote,k=F.voteDataStatus,L=Object(f.d)(),M=function(e,t){var n=(e||[]).find((function(e){return Object.entries(e).find((function(e){var n=Object(d.a)(e,2),a=n[0];return n[1],Object(I.g)(a)===Object(I.g)(t||"")}))}));if(n)return Object.entries(n)[0][1].msg.payload.choice===u.VoteChoicesIndex.Yes?b.d.Yes:b.d.No}(null===(t=p.snapshotProposal)||void 0===t?void 0:t.votes,A||""),R=Object(O.e)(),_=R.isDisabled,G=R.openWhyDisabledModal,W=R.setOtherDisabledReasons,T=R.WhyDisabledModal,U=(null===(n=p.snapshotProposal)||void 0===n?void 0:n.idInDAO)||"",Y=(null===(c=p.snapshotProposal)||void 0===c?void 0:c.idInSnapshot)||"",B=k===b.e.AWAITING_CONFIRM||k===b.e.PENDING,H=k===b.e.FULFILLED,J=_||(B||H),Z=B?v:void 0;function z(){return(z=Object(i.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,U){e.next=3;break}throw new Error("No proposal hash was found.");case 3:if(Y){e.next=5;break}throw new Error("No proposal ID was found.");case 5:return g(u.VoteChoices[t]),e.next=8,E({partialVoteData:{choice:t},adapterName:j,proposalIdInDAO:U,proposalIdInSnapshot:Y});case 8:return e.next=10,p.refetchProposalOrDraft();case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),S(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}return Object(s.useEffect)((function(){if(P){var e=L?"Your member address is delegated to ".concat(P,". You must use that address to vote."):"";C.current=Object(r.a)(Object(r.a)({},C.current),{},{addressIsDelegatedMessage:e})}C.current=Object(r.a)(Object(r.a)({},C.current),{},{alreadyVotedMessage:M?"You have already voted.":""}),W(Object.values(C.current))}),[P,L,W,M]),Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(V,{onClick:J?function(){}:function(e){return z.apply(this,arguments)},buttonProps:{disabled:J,"aria-disabled":J},voteChosen:M,voteProgress:Z}),Object(a.jsx)(m.a,{error:D,renderText:"Something went wrong"}),_&&Object(a.jsx)("button",{className:"button--help",onClick:G,children:"Why is voting disabled?"}),Object(a.jsx)(T,{title:"Why is voting disabled?"})]})}var S=n(269);function C(e){var t=e.startLabel,n=e.startPeriodMs,r=e.endLabel,c=e.endedLabel,o=e.endPeriodMs,i=Object(s.useState)(null),l=Object(d.a)(i,2),u=l[0],b=l[1],j=Object(s.useCallback)((function(e,t){var n=function(e){var t=Date.parse(e.toString())-Date.parse((new Date).toString()),n=Math.floor(t/1e3%60),a=Math.floor(t/1e3/60%60),s=Math.floor(t/36e5%24);return{total:t,days:Math.floor(t/864e5),hours:s,minutes:a,seconds:n}}(e),s=n.days,r=n.hours,c=n.minutes,o=n.seconds;return s>2&&t?"~".concat(s," days"):s>0?"".concat(p(s,"day")," : ").concat(p(r,"hr")," : ").concat(p(c,"min")):r>0?"".concat(p(r,"hr")," : ").concat(p(c,"min")):c>0?"".concat(p(c,"min")," : ").concat(p(o,"sec")):Object(a.jsx)("span",{className:"color-brightsalmon",children:p(o,"sec")})}),[]);function p(e,t){var n=0===e||e>1?"".concat(t,"s"):t;return"".concat(e," ").concat(n)}return Object(s.useEffect)((function(){var e=setInterval((function(){var s=new Date,i=new Date(n),d=new Date(o);if(s<i){var l=Object(a.jsxs)("span",{children:[Object(a.jsx)("span",{className:"votingstatus",children:t||"Starts:"})," ",Object(a.jsx)("span",{className:"votingstatus__timer",children:j(i,!0)})]});b(l)}else if(s<d){var u=Object(a.jsxs)("span",{children:[Object(a.jsx)("span",{className:"votingstatus",children:r||"Ends:"})," ",Object(a.jsx)("span",{className:"votingstatus__timer",children:j(d)})]});b(u)}else{b(Object(a.jsx)("span",{className:"votingstatus",children:c||"Ended"})),clearInterval(e)}}),1e3);return function(){clearInterval(e)}}),[j,r,o,c,t,n]),Object(a.jsx)("div",{children:u})}function P(e){return Object(a.jsxs)("svg",Object(r.a)(Object(r.a)({width:"20px",height:"20px",viewBox:"0 0 21 24",version:"1.1"},e),{},{children:[Object(a.jsx)("defs",{children:Object(a.jsx)("path",{d:"M17.6516,6.408 C19.8162,8.36 21,11.02 21,13.844 C21,19.458 16.303,24 10.5,24 C4.69616,24 0,19.457 0,13.844 C0,8.506 4.22802,4.197 9.53077,3.731 L9.53077,1.875 L6.68768,1.875 C6.15238,1.875 5.71845,1.455 5.71845,0.938 C5.71845,0.42 6.15238,0 6.68768,0 L14.3123,0 C14.8476,0 15.2815,0.42 15.2815,0.938 C15.2815,1.455 14.8476,1.875 14.3123,1.875 L11.46923,1.875 L11.46923,3.731 C13.1316,3.877 14.7126,4.398 16.1059,5.252 L17.4392,3.962 C17.8177,3.596 18.4314,3.596 18.8099,3.962 C19.1885,4.328 19.1885,4.922 18.8099,5.288 L17.6516,6.408 Z M10.5,22.125 C15.2208,22.125 19.0615,18.41 19.0615,13.844 C19.0615,9.277 15.2209,5.562 10.5,5.562 C5.77913,5.562 1.93846,9.277 1.93846,13.844 C1.93846,18.41 5.77917,22.125 10.5,22.125 Z M11.46923,8.312 L11.46923,13.844 C11.46923,14.362 11.03531,14.781 10.5,14.781 C9.96469,14.781 9.53077,14.362 9.53077,13.844 L9.53077,8.312 C9.53077,7.795 9.96469,7.375 10.5,7.375 C11.03531,7.375 11.46923,7.795 11.46923,8.312 Z",id:"path-1"})}),Object(a.jsx)("g",{id:"Page-1",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd",children:Object(a.jsxs)("g",{id:"Group-70",children:[Object(a.jsx)("mask",{id:"mask-2",fill:"white",children:Object(a.jsx)("use",{xlinkHref:"#path-1"})}),Object(a.jsx)("use",{id:"Clip-69",fill:"currentColor",xlinkHref:"#path-1"})]})})]}))}function A(e){var t=e.hasVotingEnded,n=e.noShares,s=e.renderStatus,r=e.renderTimer,c=e.showPercentages,o=void 0===c||c,i=e.totalShares,d=e.yesShares,l=s();return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{className:"votingstatus-container",children:[Object(a.jsx)(P,{"aria-label":"Counting down until voting ends",role:"img"}),l&&Object(a.jsx)("span",{className:"votingstatus",children:l}),r(C)]}),Object(a.jsx)(_,{yesShares:d,noShares:n,totalShares:i,votingExpired:t,showPercentages:o})]})}var F=Object(a.jsxs)("span",{children:["Grace period ends:",Object(a.jsx)("br",{})]}),E=Object(a.jsxs)("span",{children:["Grace period ended ",Object(a.jsx)("br",{})," ",Object(a.jsx)("span",{style:{textTransform:"none"},children:"Awaiting contract status\u2026"})]}),k={duration:150};function L(e){var t=e.countdownGracePeriodStartMs,n=e.proposal,r=n.snapshotProposal,c=Object(l.c)((function(e){var t;return null===(t=e.contracts.DaoRegistryContract)||void 0===t?void 0:t.instance})),o=Object(s.useState)(),i=Object(d.a)(o,2),u=i[0],p=i[1],h=Object(s.useState)(0),O=Object(d.a)(h,2),f=O[0],x=O[1],m=Object(y.b)(n),v=m.hasOffchainVotingStarted,g=m.hasOffchainVotingEnded,N=m.offchainVotingStartEndInitReady,w=Object(y.a)(n),I=(null===r||void 0===r?void 0:r.msg.payload.start)||0,D=(null===r||void 0===r?void 0:r.msg.payload.end)||0,C=(null===w||void 0===w?void 0:w.Yes.shares)||0,P=(null===w||void 0===w?void 0:w.No.shares)||0,L=null===w||void 0===w?void 0:w.totalShares;return Object(s.useEffect)((function(){g&&p(C>P)}),[g,P,C]),Object(s.useEffect)((function(){t&&c&&Object(j.f)(b.b.offchainVotingGracePeriod,c).then((function(e){return e&&x(1e3*Number(e))})).catch((function(){return x(0)}))}),[t,c]),Object(a.jsx)(A,{renderTimer:function(e){return N&&v&&!g?Object(a.jsx)(e,{startPeriodMs:1e3*I,endPeriodMs:1e3*D}):t&&f?Object(a.jsx)(e,{startPeriodMs:t,endLabel:F,endedLabel:E,endPeriodMs:t+f}):void 0},renderStatus:function(){return N?t?"":"boolean"===typeof u?u?"Approved":"Failed":void 0:Object(a.jsx)(S.a,{intervalMs:200,fadeInProps:k})},hasVotingEnded:g,noShares:P,totalShares:L,yesShares:C})}function M(e){return Object(a.jsx)("svg",Object(r.a)(Object(r.a)({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:"18",height:"18",viewBox:"0 0 512 512"},e),{},{children:Object(a.jsx)("path",{fill:"currentColor",d:"M435.848 83.466L172.804 346.51l-96.652-96.652c-4.686-4.686-12.284-4.686-16.971 0l-28.284 28.284c-4.686 4.686-4.686 12.284 0 16.971l133.421 133.421c4.686 4.686 12.284 4.686 16.971 0l299.813-299.813c4.686-4.686 4.686-12.284 0-16.971l-28.284-28.284c-4.686-4.686-12.284-4.686-16.97 0z"})}))}function R(e,t){return(e/t*100).toFixed(0)}function _(e){var t=e.yesShares,n=void 0===t?0:t,s=e.noShares,r=void 0===s?0:s,c=e.totalShares,o=e.votingExpired,i=e.showPercentages,d=c?R(n,c):"0",l=c?R(r,c):"0";return Object(a.jsxs)("div",{className:"votingbar-container",children:[Object(a.jsxs)("div",{className:"votingbar",children:[Object(a.jsx)("div",{className:"votingbar__segment--yes","aria-label":"".concat(d,"% yes votes"),style:{width:"".concat(d,"%")}}),Object(a.jsx)("div",{className:"votingbar__segment--no","aria-label":"".concat(l,"% no votes"),style:{width:"".concat(l,"%")}})]}),Object(a.jsx)("div",{className:"votingbar__percentages",children:i&&Object(a.jsxs)(a.Fragment,{children:[o&&n>r&&Object(a.jsx)("span",{className:"yes-check",children:Object(a.jsx)(M,{"aria-label":"Vote has passed"})}),Object(a.jsxs)("span",{className:"yes-percent",children:[d,"%"]}),Object(a.jsxs)("span",{className:"no-percent",children:[l,"%"]}),o&&n<=r&&Object(a.jsx)("span",{className:"no-check",children:Object(a.jsx)(M,{"aria-label":"Vote has failed"})})]})})]})}function V(e){var t=e.buttonProps,n=e.onClick,s=e.voteChosen,c=e.voteProgress,o=function(e){return s===e?"votingbutton--voted":""};function i(e){return c===e?{"aria-label":"Voting ".concat(e," \u2026")}:{}}function d(e){return c===e?Object(a.jsx)(N.a,{"aria-label":"Voting ".concat(e," spinner image"),role:"img"}):s===e?"Voted ".concat(e):"Vote ".concat(e)}function l(e){return function(){n(e)}}return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)("button",Object(r.a)(Object(r.a)(Object(r.a)({},t),i(u.VoteChoices.Yes)),{},{className:"proposaldetails__button ".concat(o(u.VoteChoices.Yes)),onClick:l(u.VoteChoices.Yes),children:d(u.VoteChoices.Yes)})),Object(a.jsx)("button",Object(r.a)(Object(r.a)(Object(r.a)({},t),i(u.VoteChoices.No)),{},{className:"proposaldetails__button ".concat(o(u.VoteChoices.No)),onClick:l(u.VoteChoices.No),children:d(u.VoteChoices.No)}))]})}var G=n(206),W=n(60);function T(e){var t=e.proposal,n=t.snapshotDraft,c=t.refetchProposalOrDraft,p=Object(s.useState)(),w=Object(d.a)(p,2),I=w[0],D=w[1],S=Object(l.c)((function(e){return e.contracts})),C=Object(l.c)((function(e){var t;return null===(t=e.contracts.DaoRegistryContract)||void 0===t?void 0:t.contractAddress})),P=Object(f.f)(),A=P.account,F=P.web3Instance,E=Object(f.a)(),k=E.txEtherscanURL,L=E.txIsPromptOpen,M=E.txSend,R=E.txStatus,_=Object(O.e)(),V=_.isDisabled,G=_.openWhyDisabledModal,W=_.WhyDisabledModal,T=Object(y.f)(),U=T.proposalSignAndSendStatus,Y=T.signAndSendProposal,B=Object(f.b)(),H=R===b.e.AWAITING_CONFIRM||R===b.e.PENDING||U===b.e.AWAITING_CONFIRM||U===b.e.PENDING,J=R===b.e.FULFILLED&&U===b.e.FULFILLED,Z=H||J||L;function z(){return(z=Object(i.a)(o.a.mark((function e(){var t,a,s,i,d,l,b,p,h,O,f,x,m;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,C){e.next=3;break}throw new Error("No DAO Registry address was found.");case 3:if(n){e.next=5;break}throw new Error("No Snapshot draft was found.");case 5:return t=Object(j.e)(n.actionId,S),a=n.msg,s=a.payload,i=s.name,d=s.body,l=s.metadata,b=a.timestamp,e.next=9,Y({partialProposalData:{name:i,body:d,metadata:l,timestamp:b},adapterAddress:t.contractAddress,type:u.SnapshotType.proposal});case 9:return p=e.sent,h=p.data,O=p.signature,f=Object(u.prepareVoteProposalData)({payload:{name:h.payload.name,body:h.payload.body,choices:h.payload.choices,snapshot:h.payload.snapshot.toString(),start:h.payload.start,end:h.payload.end},sig:O,space:h.space,timestamp:parseInt(h.timestamp)},F),x=[C,n.idInDAO,f],m=Object(r.a)({from:A||""},B?{gasPrice:B.fast}:null),e.next=17,M("sponsorProposal",t.instance.methods,x,m);case 17:c(),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),D(e.t0);case 23:case"end":return e.stop()}}),e,null,[[0,20]])})))).apply(this,arguments)}return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{children:[Object(a.jsx)("button",{className:"proposaldetails__button",disabled:V||Z,onClick:V||Z?function(){}:function(){return z.apply(this,arguments)},children:H?Object(a.jsx)(N.a,{}):J?"Done":"Sponsor"}),Object(a.jsx)(m.a,{error:I,renderText:"Something went wrong"}),Z&&Object(a.jsx)("div",{className:"form__submit-status-container",children:function(){if(R===b.e.AWAITING_CONFIRM||U===b.e.AWAITING_CONFIRM)return"Awaiting your confirmation\u2026";switch(R){case b.e.PENDING:return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(x.a,{intervalMs:2e3,messages:h.b,useFirstItemStart:!0,render:function(e){return Object(a.jsx)(g.a,{children:e},e)}}),Object(a.jsx)(v.a,{url:k,isPending:!0})]});case b.e.FULFILLED:return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)("div",{children:"Proposal submitted!"}),Object(a.jsx)(v.a,{url:k})]});default:return null}}()}),V&&Object(a.jsx)("button",{className:"button--help",onClick:G,children:"Why is sponsoring disabled?"})]}),Object(a.jsx)(W,{title:"Why is sponsoring disabled?"})]})}function U(e){var t=e.disabled,n=e.proposal.snapshotProposal,c=Object(s.useState)(),u=Object(d.a)(c,2),p=u[0],w=u[1],I=Object(l.c)((function(e){return e.contracts})),y=Object(l.c)((function(e){var t;return null===(t=e.contracts.DaoRegistryContract)||void 0===t?void 0:t.contractAddress})),D=Object(f.f)().account,C=Object(f.a)(),P=C.txEtherscanURL,A=C.txIsPromptOpen,F=C.txSend,E=C.txStatus,k=Object(O.e)(),L=k.isDisabled,M=k.openWhyDisabledModal,R=k.WhyDisabledModal,_=Object(f.b)(),V=E===b.e.AWAITING_CONFIRM||E===b.e.PENDING,G=E===b.e.FULFILLED,W=V||G||A,T=L||W||t;function U(){return(U=Object(i.a)(o.a.mark((function e(){var t,a,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,y){e.next=3;break}throw new Error("No DAO Registry address was found.");case 3:if(n){e.next=5;break}throw new Error("No Snapshot proposal was found.");case 5:return t=Object(j.e)(n.actionId,I),a=[y,n.idInDAO],s=Object(r.a)({from:D||""},_?{gasPrice:_.fast}:null),e.next=10,F("processProposal",t.instance.methods,a,s);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),w(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{children:[Object(a.jsx)("button",{className:"proposaldetails__button",disabled:T,onClick:T?function(){}:function(){return U.apply(this,arguments)},children:V?Object(a.jsx)(N.a,{}):G?"Done":"Process"}),Object(a.jsx)(m.a,{error:p,renderText:"Something went wrong"}),W&&Object(a.jsx)("div",{className:"form__submit-status-container",children:function(){switch(E){case b.e.AWAITING_CONFIRM:return Object(a.jsxs)(a.Fragment,{children:["Awaiting your confirmation",Object(a.jsx)(S.a,{})]});case b.e.PENDING:return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(x.a,{intervalMs:2e3,messages:h.b,useFirstItemStart:!0,render:function(e){return Object(a.jsx)(g.a,{children:e},e)}}),Object(a.jsx)(v.a,{url:P,isPending:!0})]});case b.e.FULFILLED:return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)("div",{children:"Proposal submitted!"}),Object(a.jsx)(v.a,{url:P})]});default:return null}}()}),L&&Object(a.jsx)("button",{className:"button--help",onClick:M,children:"Why is processing disabled?"})]}),Object(a.jsx)(R,{title:"Why is processing disabled?"})]})}function Y(e){var t=e.adapterName,n=e.proposal.snapshotProposal,c=Object(s.useState)(),u=Object(d.a)(c,2),p=u[0],w=u[1],I=Object(s.useRef)({alreadyCompletedMessage:""}),y=Object(l.c)((function(e){return e.contracts})),D=Object(l.c)((function(e){return e.contracts.DaoRegistryContract})),C=Object(f.f)().account,P=Object(f.a)(),A=P.txEtherscanURL,F=P.txIsPromptOpen,E=P.txSend,k=P.txStatus,L=Object(O.e)(),M=L.isDisabled,R=L.openWhyDisabledModal,_=L.WhyDisabledModal,V=L.setOtherDisabledReasons,G=Object(f.b)(),T=k===b.e.AWAITING_CONFIRM||k===b.e.PENDING,U=k===b.e.FULFILLED,Y=T||U||F,B=M||Y;function H(){return J.apply(this,arguments)}function J(){return(J=Object(i.a)(o.a.mark((function e(){var a,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next=e.t0===b.a.distribute?3:19;break;case 3:if(D){e.next=5;break}throw new Error("No DAO Registry contract was found.");case 5:if(a="0",!(null===n||void 0===n?void 0:n.msg.payload.metadata.isTypeAllMembers)){e.next=18;break}return e.prev=8,e.next=11,D.instance.methods.getNbMembers().call();case 11:s=e.sent,a=s.toString(),e.next=18;break;case 15:throw e.prev=15,e.t1=e.catch(8),new Error("Error while retrieving number of DAO members");case 18:return e.abrupt("return",{functionName:"distribute",functionArguments:[D.contractAddress,a]});case 19:return e.abrupt("return",{functionName:"",functionArguments:[]});case 20:case"end":return e.stop()}}),e,null,[[8,15]])})))).apply(this,arguments)}function Z(){return(Z=Object(i.a)(o.a.mark((function e(){var t,a,s,c,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n){e.next=3;break}throw new Error("No Snapshot proposal was found.");case 3:return t=Object(j.e)(n.actionId,y),e.next=6,H();case 6:return a=e.sent,s=a.functionName,c=a.functionArguments,i=Object(r.a)({from:C||""},G?{gasPrice:G.fast}:null),e.next=12,E(s,t.instance.methods,c,i);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),w(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})))).apply(this,arguments)}function z(){switch(t){case b.a.distribute:return"Assets transferred!";default:return"Action submitted!"}}function K(){switch(t){case b.a.distribute:return{start:"Transfer assets",done:"Transfer done"};default:return{start:"Process action",done:"Done"}}}return Object(s.useEffect)((function(){function e(){return(e=Object(i.a)(o.a.mark((function e(){var a,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==b.a.distribute){e.next=16;break}if(n){e.next=3;break}throw new Error("No Snapshot proposal was found.");case 3:if(D){e.next=5;break}throw new Error("No DAO Registry contract was found.");case 5:return e.prev=5,a=Object(j.e)(n.actionId,y),e.next=9,a.instance.methods.distributions(D.contractAddress,n.idInDAO).call();case 9:s=e.sent,I.current=Object(r.a)(Object(r.a)({},I.current),{},{alreadyCompletedMessage:W.a[s.status]!==W.a[W.a.IN_PROGRESS]?"The transfer has already been completed.":""}),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),console.error(e.t0);case 16:V(Object.values(I.current));case 17:case"end":return e.stop()}}),e,null,[[5,13]])})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[t,y,D,V,n]),Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{children:[Object(a.jsx)("button",{className:"proposaldetails__button",disabled:B,onClick:B?function(){}:function(){return Z.apply(this,arguments)},children:T?Object(a.jsx)(N.a,{}):U?K().done:K().start}),Object(a.jsx)(m.a,{error:p,renderText:"Something went wrong"}),Y&&Object(a.jsx)("div",{className:"form__submit-status-container",children:function(){switch(k){case b.e.AWAITING_CONFIRM:return Object(a.jsxs)(a.Fragment,{children:["Awaiting your confirmation",Object(a.jsx)(S.a,{})]});case b.e.PENDING:return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(x.a,{intervalMs:2e3,messages:h.b,useFirstItemStart:!0,render:function(e){return Object(a.jsx)(g.a,{children:e},e)}}),Object(a.jsx)(v.a,{url:A,isPending:!0})]});case b.e.FULFILLED:return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)("div",{children:z()}),Object(a.jsx)(v.a,{url:A})]});default:return null}}()}),M&&Object(a.jsx)("button",{className:"button--help",onClick:R,children:"Why is action disabled?"})]}),Object(a.jsx)(_,{title:"Why is action disabled?"})]})}function B(e){var t=e.adapterName,n=e.proposal,s=Object(y.d)(n),r=s.daoProposalVotes,c=s.status,o=s.daoProposalVoteResult,i=r&&c===W.c.OffchainVotingGracePeriod?1e3*Number(r.gracePeriodStartingTime):0,d=t===b.a.distribute&&c===W.c.Completed&&o&&G.a[o]===G.a[G.a.PASS];return Object(a.jsxs)(a.Fragment,{children:[(c===W.c.OffchainVoting||c===W.c.OffchainVotingSubmitResult||c===W.c.OffchainVotingGracePeriod||c===W.c.Process||c===W.c.Completed)&&Object(a.jsx)(L,{countdownGracePeriodStartMs:i,proposal:n}),Object(a.jsxs)("div",{className:"proposaldetails__button-container",children:[c===W.c.Sponsor&&Object(a.jsx)(T,{proposal:n}),c===W.c.OffchainVoting&&Object(a.jsx)(D,{adapterName:t,proposal:n}),c===W.c.OffchainVotingSubmitResult&&Object(a.jsx)(w,{adapterName:t,proposal:n}),(c===W.c.OffchainVotingGracePeriod||c===W.c.Process)&&Object(a.jsx)(U,{disabled:c===W.c.OffchainVotingGracePeriod,proposal:n}),d&&Object(a.jsx)(Y,{adapterName:t,proposal:n})]})]})}}}]);
//# sourceMappingURL=3.88170f9b.chunk.js.map