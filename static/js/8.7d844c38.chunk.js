(this["webpackJsonptribute-ui"]=this["webpackJsonptribute-ui"]||[]).push([[8],{1010:function(t,e,a){"use strict";a.r(e),a.d(e,"default",(function(){return R}));var r=a(7),s=a(132),n=a(37),o=a(41),c=a(17),i=a(27),d=a(2),l=a.n(d),b=a(3),u=a(10),p=a(4),j=a(1),f=a(14),O=a(61),h=a(19),x=a(29),m=a(60),g=a(15),I=a(40),N=a(6),w=a(69),v=a(49),P=a(23),y=a(42),D=a(0),F={skipIsActiveMemberCheck:!0};function S(t){var e=t.disabled,a=t.proposal.snapshotProposal,r=Object(j.useState)(),s=Object(p.a)(r,2),n=s[0],o=s[1],c=Object(f.c)((function(t){return t.contracts})),d=Object(f.c)((function(t){return t.contracts.DaoRegistryContract})),S=Object(g.f)(),A=S.account,k=S.web3Instance,E=Object(g.a)(),R=E.txEtherscanURL,L=E.txIsPromptOpen,C=E.txSend,G=E.txStatus,_=Object(I.f)(F),M=_.isDisabled,V=_.openWhyDisabledModal,W=_.WhyDisabledModal,T=Object(g.b)().fast,U=Object(f.b)(),J=G===N.f.AWAITING_CONFIRM||G===N.f.PENDING,Y=G===N.f.FULFILLED,q=J||Y||L,z=M||q||e;function B(){return(B=Object(u.a)(l.a.mark((function t(){var e,r,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,d){t.next=3;break}throw new Error("No DAO Registry contract was found.");case 3:if(a){t.next=5;break}throw new Error("No Snapshot proposal was found.");case 5:if(A){t.next=7;break}throw new Error("No account found.");case 7:if(k){t.next=9;break}throw new Error("No Web3 instance was found.");case 9:return e=Object(x.e)(a.actionId,c),r=[d.contractAddress,a.idInDAO],s=Object(b.a)({from:A||""},T?{gasPrice:T}:null),t.next=14,C("processProposal",e.instance.methods,r,s);case 14:if(!t.sent){t.next=18;break}return t.next=18,U(Object(h.A)({account:A,daoRegistryContract:d,web3Instance:k}));case 18:t.next=23;break;case 20:t.prev=20,t.t0=t.catch(0),o(t.t0);case 23:case"end":return t.stop()}}),t,null,[[0,20]])})))).apply(this,arguments)}return Object(D.jsxs)(D.Fragment,{children:[Object(D.jsxs)("div",{children:[Object(D.jsx)("button",{className:"proposaldetails__button",disabled:z,onClick:z?function(){}:function(){return B.apply(this,arguments)},children:J?Object(D.jsx)(y.a,{}):Y?"Done":"Process"}),Object(D.jsx)(i.a,{error:n,renderText:"Something went wrong"}),q&&Object(D.jsx)("div",{className:"form__submit-status-container",children:function(){switch(G){case N.f.AWAITING_CONFIRM:return Object(D.jsxs)(D.Fragment,{children:["Awaiting your confirmation",Object(D.jsx)(O.a,{})]});case N.f.PENDING:return Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)(w.a,{intervalMs:2e3,messages:m.b,useFirstItemStart:!0,render:function(t){return Object(D.jsx)(P.a,{children:t},t)}}),Object(D.jsx)(v.a,{url:R,isPending:!0})]});case N.f.FULFILLED:return Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)("div",{children:"Proposal submitted!"}),Object(D.jsx)(v.a,{url:R})]});default:return null}}()}),M&&Object(D.jsx)("button",{className:"button--help-centered",onClick:V,children:"Why is processing disabled?"})]}),Object(D.jsx)(W,{title:"Why is processing disabled?"})]})}var A=a(21);function k(t){var e=t.proposal,a=e.snapshotDraft,r=e.refetchProposalOrDraft,s=Object(j.useState)(),n=Object(p.a)(s,2),c=n[0],d=n[1],O=Object(f.c)((function(t){return t.contracts})),h=Object(f.c)((function(t){var e;return null===(e=t.contracts.DaoRegistryContract)||void 0===e?void 0:e.contractAddress})),F=Object(g.f)(),S=F.account,k=F.web3Instance,E=Object(g.a)(),R=E.txEtherscanURL,L=E.txIsPromptOpen,C=E.txSend,G=E.txStatus,_=Object(I.f)(),M=_.isDisabled,V=_.openWhyDisabledModal,W=_.WhyDisabledModal,T=Object(o.i)(),U=T.proposalSignAndSendStatus,J=T.signAndSendProposal,Y=Object(g.b)().fast,q=G===N.f.AWAITING_CONFIRM||G===N.f.PENDING||U===N.f.AWAITING_CONFIRM||U===N.f.PENDING,z=G===N.f.FULFILLED&&U===N.f.FULFILLED,B=q||z||L;function H(){return(H=Object(u.a)(l.a.mark((function t(){var e,s,n,o,c,i,u,p,j,f,m,g,I;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,h){t.next=3;break}throw new Error("No DAO Registry address was found.");case 3:if(a){t.next=5;break}throw new Error("No Snapshot draft was found.");case 5:return e=Object(x.e)(a.actionId,O),s=a.msg,n=s.payload,o=n.name,c=n.body,i=n.metadata,u=s.timestamp,t.next=9,J({partialProposalData:{name:o,body:c,metadata:i,timestamp:u},adapterAddress:e.contractAddress,type:A.SnapshotType.proposal});case 9:return p=t.sent,j=p.data,f=p.signature,m=Object(A.prepareVoteProposalData)({payload:{name:j.payload.name,body:j.payload.body,choices:j.payload.choices,snapshot:j.payload.snapshot.toString(),start:j.payload.start,end:j.payload.end},sig:f,space:j.space,timestamp:parseInt(j.timestamp)},k),g=[h,a.idInDAO,m],I=Object(b.a)({from:S||""},Y?{gasPrice:Y}:null),t.next=17,C("sponsorProposal",e.instance.methods,g,I);case 17:r(),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(0),d(t.t0);case 23:case"end":return t.stop()}}),t,null,[[0,20]])})))).apply(this,arguments)}return Object(D.jsxs)(D.Fragment,{children:[Object(D.jsxs)("div",{children:[Object(D.jsx)("button",{className:"proposaldetails__button",disabled:M||B,onClick:M||B?function(){}:function(){return H.apply(this,arguments)},children:q?Object(D.jsx)(y.a,{}):z?"Done":"Sponsor"}),Object(D.jsx)(i.a,{error:c,renderText:"Something went wrong"}),B&&Object(D.jsx)("div",{className:"form__submit-status-container",children:function(){if(G===N.f.AWAITING_CONFIRM||U===N.f.AWAITING_CONFIRM)return"Awaiting your confirmation\u2026";switch(G){case N.f.PENDING:return Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)(w.a,{intervalMs:2e3,messages:m.b,useFirstItemStart:!0,render:function(t){return Object(D.jsx)(P.a,{children:t},t)}}),Object(D.jsx)(v.a,{url:R,isPending:!0})]});case N.f.FULFILLED:return Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)("div",{children:"Proposal submitted!"}),Object(D.jsx)(v.a,{url:R})]});default:return null}}()}),M&&Object(D.jsx)("button",{className:"button--help-centered",onClick:V,children:"Why is sponsoring disabled?"})]}),Object(D.jsx)(W,{title:"Why is sponsoring disabled?"})]})}var E=a(200);function R(t){var e,a=t.adapterName,d=t.proposal,l=t.renderAction,b=Object(o.e)(d),u=b.daoProposalVoteResult,p=b.daoProposalVotes,j=b.proposalFlowStatusError,f=b.status,O=Object(o.c)(d.snapshotProposal).offchainVotingResults,h=p&&f===n.c.OffchainVotingGracePeriod?1e3*Number(p.gracePeriodStartingTime)||Date.now():0,x=l&&l(Object(r.a)({},c.c.OffchainVotingContract,{adapterName:a,daoProposalVoteResult:u,daoProposalVotes:p,gracePeriodStartMs:h,proposal:d,status:f})),m=null===(e=O[0])||void 0===e?void 0:e[1],g=(null===m||void 0===m?void 0:m.Yes.units)||0,I=(null===m||void 0===m?void 0:m.No.units)||0;return Object(D.jsxs)(D.Fragment,{children:[(f===n.c.OffchainVoting||f===n.c.OffchainVotingSubmitResult||f===n.c.OffchainVotingGracePeriod||f===n.c.Process||f===n.c.Completed)&&Object(D.jsx)(s.c,{countdownGracePeriodStartMs:h,proposal:d,votingResult:m}),Object(D.jsx)("div",{className:"proposaldetails__button-container",children:x||(f===n.c.Submit?Object(D.jsx)(E.a,{proposal:d}):f===n.c.Sponsor?Object(D.jsx)(k,{proposal:d}):f===n.c.OffchainVoting?Object(D.jsx)(s.b,{adapterName:a,proposal:d}):f===n.c.OffchainVotingSubmitResult?g<=I?Object(D.jsx)(D.Fragment,{}):Object(D.jsx)(s.a,{adapterName:a,proposal:d}):f===n.c.Process||f===n.c.OffchainVotingGracePeriod?Object(D.jsx)(S,{disabled:f===n.c.OffchainVotingGracePeriod,proposal:d}):void 0)}),Object(D.jsx)(i.a,{error:j,renderText:"Something went wrong while getting the proposal's status"})]})}}}]);
//# sourceMappingURL=8.7d844c38.chunk.js.map